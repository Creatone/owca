<source>
  @type tail
  path /fluentd/log/app-stdout.log
  pos_file /fluentd/log/app-stdout.log.pos
  tag app-stdout
  <parse>
    @type none
  </parse>
</source>

<source>
  @type tail
  path /fluentd/log/app-stderr.log
  pos_file /fluentd/log/app-stderr.log.pos
  tag app-stderr
  <parse>
    @type none
  </parse>
</source>

#<filter **>
#  @type stdout
#</filter>

<source>
  @type prometheus
</source>

<filter app-stdout>
  @type prometheus
  <metric>
    name message_foo_counter
    type counter
    desc The total number of foo in message.
    #key message
  </metric>
</filter>

#<match app-stdout>
#  @type stdout
#</match>

<match app-stdout>
  @type copy
  <store>
    @type prometheus
    <metric>
      name message_foo_counter
      type counter
      desc The total number of foo in message.
      #key foo
    </metric>
  </store>
  <store>
    @type stdout
  </store>
</match>

#<label @mainstream>
#  <match **>
#    @type file
#    @id   output1
#    path         /fluentd/log/data.*.log
#    symlink_path /fluentd/log/data.log
#    append       true
#    time_slice_format %Y%m%d
#    time_slice_wait   10m
#    time_format       %Y%m%dT%H%M%S%z
#  </match>
#</label>