<match fluent.**>
  @type null
</match>
<source>
  @type dummy
  tag dummy
  dummy {"hello":"world"}
</source>
<source>
  @type prometheus
</source>

<source>
  @type tail
  path /var/log/containers/*.log
  pos_file /var/log/fluentd-containers.log.pos
  time_format %Y-%m-%dT%H:%M:%S.%NZ
  tag kubernetes.*
  format json
  read_from_head true
</source>
<filter kubernetes.**>
  @type kubernetes_metadata
</filter>
<match kubernetes.var.log.containers.**fluentd**.log>
  @type null
</match>
<match kubernetes.var.log.containers.**monitoring**.log>
  @type null
</match>
#<filter foo.bar>
#  @type parser
#  key_name log
#  <parse>
#    @type regexp
#    expression /^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)$/
#         /(?P<bogo_ops>\d+.\d*) (?P<real_time>\d+.\d*) (?P<user_time>\d+.\d*) (?P<system_time>\d+.\d*) (?P<bogo_ops_per_second_real_time>\d+.\d*) (?P<bogo_ops_per_second_usr_sys_time>\d+.\d*)/
#    time_format %d/%b/%Y:%H:%M:%S %z
#  </parse>
#</filter>

<filter kubernetes.var.log.containers.stress**>
  @type parser
  #@label @to_prom
  key_name log
  <parse>
    @type regexp
    expression /^stress-ng: info: {2}\[(?<id>\d*)\]+ Time (?<time>\d*), counter (?<counter>\d*)/
    time_format %s
  </parse>
</filter>


#<filter dummy>
#  @type prometheus
#  <metric>
#    name dummy_messages
#    type counter
#    desc The total number of incoming dummy messages
#    <labels>
#      tag ${tag}
#      hostname ${hostname}
#    </labels>
#  </metric>
#</filter>

<filter kubernetes.var.log.containers.**>
  @type prometheus
  <metric>
    name stdout_lines
    type counter
    desc Number of stdout lines
    <labels>
      hostname ${hostname}
      app $.kubernetes.labels.app
      workload $.kubernetes.labels.workload
    </labels>
  </metric>
</filter>

<filter dummy>
  @type prometheus
  <metric>
    name dummy_messages
    type counter
    desc The total number of incoming dummy messages
    <labels>
      tag ${tag}
      hostname ${hostname}
    </labels>
  </metric>
</filter>
 <match **>
   @type stdout
 </match>
